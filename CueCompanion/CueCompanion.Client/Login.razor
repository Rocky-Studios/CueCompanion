@using System.ComponentModel.DataAnnotations
@rendermode InteractiveAuto
<div class="login">
    <h3>Login</h3>
    <EditForm Model="@loginModel" OnValidSubmit="HandleValidSubmit">
        <DataAnnotationsValidator/>
        <ValidationSummary/>

        <div class="form-group">
            <label for="username">Connection Name</label>
            <InputText id="username" class="form-control" @bind-Value="loginModel.ConnectionName"/>
        </div>

        <div class="form-group">
            <label for="password">Passkey</label>
            <InputText id="password" type="password" class="form-control" @bind-Value="loginModel.ConnectionPaskey"/>
        </div>

        <button type="submit" class="btn btn-primary">Login</button>
        <button type="button" class="btn btn-primary" @onclick="LoadPreviousConnection">Load previous connection
        </button>
    </EditForm>

</div>

@code
{
    [Parameter] public Func<string, string, Task>? OnSubmit { get; set; }
    protected LoginModel loginModel = new();

    protected class LoginModel
    {
        [Required] public string? ConnectionName { get; set; }

        [Required] public string? ConnectionPaskey { get; set; }
    }

    protected async Task HandleValidSubmit()
    {
        if (OnSubmit != null)
        {
            await OnSubmit(loginModel.ConnectionName ?? "", loginModel.ConnectionPaskey ?? "");
        }
    }

    protected async Task LoadPreviousConnection()
    {
        string? name = await LocalStorage.GetItemAsync("connectionName");
        string? passkey = await LocalStorage.GetItemAsync("connectionPasskey");
        if (!string.IsNullOrEmpty(name) && !string.IsNullOrEmpty(passkey))
        {
            loginModel.ConnectionName = name;
            loginModel.ConnectionPaskey = passkey;
        }
    }
}
